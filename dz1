import os
import shutil
import argparse
from pathlib import Path

def recursive_copy_and_sort(src_path: Path, dest_path: Path):
    try:
        for item in src_path.iterdir():
            if item.is_dir():
                recursive_copy_and_sort(item, dest_path)  # рекурсія
            elif item.is_file():
                ext = item.suffix[1:] if item.suffix else 'no_extension'
                target_dir = dest_path / ext
                target_dir.mkdir(parents=True, exist_ok=True)
                shutil.copy2(item, target_dir / item.name)
    except Exception as e:
        print(f"[ПОМИЛКА] Неможливо обробити {src_path}: {e}")

def main():
    parser = argparse.ArgumentParser(description="Рекурсивне копіювання та сортування файлів")
    parser.add_argument("src", help="Шлях до вихідної директорії")
    parser.add_argument("dist", nargs="?", default="dist", help="Шлях до директорії призначення (за замовчуванням: dist)")

    args = parser.parse_args()
    src = Path(args.src)
    dist = Path(args.dist)

    if not src.exists() or not src.is_dir():
        print("[ПОМИЛКА] Вихідна директорія не існує або не є директорією.")
        return

    dist.mkdir(parents=True, exist_ok=True)

    print(f"[INFO] Починаємо сортування з {src} до {dist}")
    recursive_copy_and_sort(src, dist)
    print(f"[INFO] Завершено копіювання та сортування.")

if __name__ == "__main__":
    main()
